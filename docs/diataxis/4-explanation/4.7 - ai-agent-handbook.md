## Explanation: AI Agent Handbook

This note captures operational context for AI maintainers working on Metrics Reporter. Keep it close when automating refactors or debugging CI issues.

### Project structure

- `src/MetricsReporter` – Library that aggregates metrics and emits JSON/HTML.
- `src/MetricsReporter.Tool` – Pack-as-tool CLI exposing `metricsreporter` commands (Spectre.Console.Cli).
- `tests/MetricsReporter.Tests` – NUnit + FluentAssertions + NSubstitute.
- `docs/diataxis` – This documentation set (generated by you!).

### Distribution model

- Packages are published to a local feed: `C:\Users\baidakov\.nuget\local-feed`.
- Tool manifests in consumer repos (e.g., `sample-plugin/.config/dotnet-tools.json`) pin the exact `MetricsReporter.Tool` version.
- Tool binaries live in `%USERPROFILE%\.dotnet\tools` plus `%USERPROFILE%\.dotnet\toolspkgs`.
- Library packages can also be referenced directly via `PackageReference`.

### Working with versions

- Always bump at least the patch version after code changes. Reusing the same semantic version forces consumers to purge `%USERPROFILE%\.nuget\packages\metricsreporter*\<version>` and leads to confusing cache issues.
- After bumping, run `dotnet pack` for both the library and the tool, writing to the local feed.
- Update consumer repositories with `dotnet tool update --add-source <feed> MetricsReporter.Tool --version <new-version>` and, if needed, `dotnet add package MetricsReporter`.

### Running from source

- Use `dotnet run --project src/MetricsReporter.Tool/MetricsReporter.Tool.csproj -- <command>` when you need instant feedback without packing.
- For generator experiments, target `src/MetricsReporter/MetricsReporter.csproj` directly and pass explicit `--altcover`, `--roslyn`, `--sarif`, `--baseline`, `--output-json`, and `--output-html` flags.

### Metric generation workflow

Use the Spectre CLI (`metricsreporter`) plus optional PowerShell hooks defined in `.metricsreporter.json`:

```powershell
# prepare inputs in scripts/generate*.ps1 if needed (AltCover, Roslyn, SARIF, baselines)
metricsreporter generate `
  --metrics-dir build/Metrics `
  --altcover build/MetricsTemp/CoverageStorage.g.xml `
  --roslyn build/Metrics/Roslyn/SolutionMetrics.g.xml `
  --sarif build/Metrics/Sarif/ca.sarif `
  --baseline build/MetricsTemp/MetricsBaseline.g.json `
  --output-json build/Metrics/Report/MetricsReport.g.json `
  --output-html build/Metrics/Report/MetricsReport.html `
  --thresholds-file build/MetricsRules/MetricsReporterThresholds.json `
  --coverage-html-dir build/Metrics/AltCover/html
```

Outputs land in `build/Metrics/Report` (JSON/HTML) and `build/MetricsTemp` (baseline, suppressed symbols). No MSBuild targets run automatically—hook coverage/metrics generation into scripts or CI steps as needed.


Stay explicit about **why** you make changes—future AI agents rely on that context to keep the tool healthy.
