## Explanation: MetricsUpdater Retrospective

`MetricsUpdater` was an MSBuild-centric orchestrator that lived inside the legacy CLI before the Spectre refactor. It has been removed, but understanding its strengths and weaknesses helps justify the current design.

### What MetricsUpdater did

- Lived in `src/MetricsReporter/MetricsReader/Services/MetricsUpdater.cs`.
- Launched two sequential `dotnet msbuild` commands:
  1. `CollectCoverage` on a runtime project (controlled by `AltCoverEnabled=true` in `code-metrics.props`). The runtime project carried AltCover instrumentation targets. A `METRICS_RUNTIME_PROJECT` env var allowed overrides.
  2. `GenerateMetricsDashboard` on an “anchor” test project to aggregate metrics and generate HTML/baseline artifacts.
- Streamed stdout/stderr to the console; non-zero exit codes threw `InvalidOperationException`.

### Anchor project resolution

1. Environment variables: `METRICS_TARGETS_ANCHOR_PROJECT` or `METRICS_REPORTER_ANCHOR_PROJECT` (value could be `ProjectName` or `ProjectName.csproj`).
2. Fallback pattern: `MetricsReporter.Tests.csproj`.
3. Failure path: exception with message `Metrics anchor project file could not be located`.

### Strengths

- **Self-contained orchestration** – No external scripts; everything went through `dotnet msbuild`.
- **Configurable anchor** – Env vars let consumers pick the project that owned the `GenerateMetricsDashboard` target.
- **Sequential safety** – Coverage always ran before aggregation, guaranteeing fresh artifacts.

### Weaknesses

- **Hard MSBuild coupling** – Command lines were rigid, tightly bound to repo-specific target names and project structures.
- **Opaque configuration** – Critical behavior (anchor selection, runtime project path) lived in undocumented env vars instead of CLI options or config files.
+- **Poor error typing** – Failures surfaced as generic `InvalidOperationException` with minimal context, complicating diagnostics.
- **Mixed responsibilities** – One class triggered coverage, metrics, and console I/O, violating the single-responsibility principle.
- **Limited logging** – No structured logging or duration tracking; consumers had to parse console text.

### Replacement strategy

The Spectre-based CLI and new services split concerns cleanly:

- `IProcessRunner` abstracts process execution, enabling deterministic tests and richer diagnostics (args, exit codes, duration).
- CLI options and `.metricsreporter.json` replaced env-var contracts with typed, validated settings.
- Orchestration now lives in MSBuild targets plus the `MetricsReporter` executable, so external repos can opt-in with a single property rather than mirroring custom scripts.
- Structured logging via `ILogger` surfaces actionable messages and preserves context for AI maintainers.

### Minimal migration tips

If you still work with a fork that references `MetricsUpdater`:

1. Keep env-var overrides temporarily, but start migrating to CLI options or config files (`--metrics-dir`, `--solution-name`, `--altcover`, etc.).
2. Introduce an interface similar to `IMetricsUpdateOrchestrator` so orchestration can be swapped without touching the command surface.
3. Add logging and richer error messages before attempting larger refactors; this pays dividends during dogfooding.

The new architecture keeps orchestration declarative (MSBuild properties + CLI options) and leaves process execution to reusable services, making the tool friendlier to CI environments and future contributors.

