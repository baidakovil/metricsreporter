## Tutorial: Produce Your First Metrics Reporter Dashboard

**Goal.** Build the sample plugin, collect coverage, aggregate Roslyn/SARIF metrics, and open the generated HTML dashboard. Plan ~10 minutes on a clean machine.

### 1. Prerequisites

- .NET 8 SDK with `dotnet` available on `PATH`.
- AltCover instrumentation targets referenced by the consumer solution (already wired into `code-metrics.props`).
- Git access to clone both repos listed below.

### 2. Clone the repositories

```powershell
git clone https://github.com/baidakov/metricsreporter C:\src\metricsreporter
git clone https://github.com/baidakov/sample-plugin C:\src\sample-plugin
```

The first repo contains the tool; the second is a tiny Revit-like plugin used for demonstrations and tests.

### 3. Restore and install the tool inside the sample plugin

```powershell
cd C:\src\sample-plugin
dotnet tool restore
```

`dotnet tool restore` reads `.config/dotnet-tools.json` and installs the `metricsreporter` CLI pinned by the sample plugin. The tool binaries land in `%USERPROFILE%\.dotnet\tools` and `%USERPROFILE%\.dotnet\toolspkgs`.

### 4. Build and generate metrics

```powershell
# Build or CI steps should produce coverage/metrics inputs first (AltCover, Roslyn, SARIF).
# Then run the CLI to aggregate and render reports:
metricsreporter generate ^
  --metrics-dir Metrics ^
  --altcover Metrics/MetricsTemp/CoverageStorage.g.xml ^
  --roslyn Metrics/Roslyn/SolutionMetrics.g.xml ^
  --sarif Metrics/Sarif/ca.sarif ^
  --baseline Metrics/MetricsTemp/MetricsBaseline.g.json ^
  --output-json Metrics/MetricsReport.g.json ^
  --output-html Metrics/MetricsReport.html ^
  --thresholds-file Metrics/MetricsRules/MetricsReporterThresholds.json
```

What happens:

1. Your prior steps (or `scripts.generate` hooks) must produce AltCover XML, Roslyn metrics XML, and SARIF files under `build/Metrics`.
2. The CLI aggregates inputs, applies thresholds/baseline, and writes JSON/HTML to `build/Metrics/Report`.
3. If `--replace-baseline` (or config) is set, the previous report is archived and the new one becomes the baseline before deltas are computed.

### 5. Inspect the outputs

After a successful build you should see:

| Artifact | Path | Purpose |
| --- | --- | --- |
| `MetricsReport.g.json` | `Metrics/` | Canonical tree Solution → Member with metric values, deltas, suppression flags, and metadata. |
| `MetricsReport.html` | `Metrics/` | Interactive dashboard; use the filter box, detail slider (Namespace→Type→Member), and awareness slider (All→Warning→Error). Preferences persist via `localStorage`. |
| `MetricsBaseline.g.json` | `Metrics/MetricsTemp/` | Snapshot used for delta calculations next time. |
| `SuppressedSymbols.g.json` | `Metrics/MetricsTemp/` | Symbols decorated with `[SuppressMessage]`, linked back to Roslyn metric identifiers. |

Open `MetricsReport.html` in a browser. Try toggling:

- **Detailing** – limit the deepest visible level without re-rendering the table.
- **Awareness** – show only warnings or errors; ancestors stay visible so you retain context.
- **Filter** – type a namespace prefix or rule ID; the JS layer caches DOM nodes, so filtering is instant even for 50k rows.

### 6. Explore the data with `metricsreporter read`

Still inside `sample-plugin`, run:

```powershell
metricsreporter read `
  --report build/Metrics/Report/MetricsReport.g.json `
  --namespace Sample.Loader.Services `
  --metric Coupling `
  --group-by type `
  --all
```

This command demonstrates how CLI queries reuse the same JSON model generated above. Switch to `readsarif` to inspect analyzer violations grouped by `ruleId`.

### 7. Next steps

- Customize thresholds via `build/MetricsRules/MetricsReporterThresholds.json`.
- Add more AltCover files by repeating `/p:AltCoverReports=...` or CLI `--altcover` arguments; the aggregator fails fast if a symbol appears in multiple files, protecting data integrity.
- Read the Diataxis how-to guides when you need to ship a patched build or execute the tool directly from the repo.

