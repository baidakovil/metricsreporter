## Explanation: Namespace Inference for Mixed Data Sources

AltCover, Roslyn, and SARIF describe the same symbols with different parent hierarchies. Roslyn includes explicit namespaces, while AltCover places every class directly under the assembly and relies on slash/plus notation for nested types. Metrics Reporter reconciles these discrepancies so the aggregated tree (and downstream tooling) exposes a single, canonical namespace layout.

### Inference pipeline

1. **Parsers emit raw parents**
   - Roslyn nodes ship with `ParentFullyQualifiedName` values for assemblies, namespaces, types, and members.
   - AltCover nodes default to the assembly as parent because namespaces do not exist in the XML structure.
2. **Structural merge (`StructuralElementMerger`)**
   - When a node arrives with a namespace parent (Roslyn case), we keep it as-is.
   - Otherwise `ResolveNamespaceFromIndexesOrFqn` looks up the longest namespace prefix recorded so far.
3. **Fallback slicing (`NamespaceResolutionHelper.ExtractNamespaceFromTypeFqn`)**
   - If no prefix matches, the helper slices the normalized FQN at the last dot to synthesize the namespace.
   - `<global>` is used when the FQN contains no dot, ensuring even script-like files have a stable home.
4. **Nested type cleanup (`PlainNestedTypeCoverageReconciler`)**
   - Converts `Outer+Inner` names into dot notation, ensures a dot-type exists, then moves any coverage metrics across before removing the `+` node.

### Edge cases and safeguards

| Scenario | Behavior | Guardrail |
| --- | --- | --- |
| Namespace names already contain dots (`MyCompany.Services.Core`) | Longest-prefix lookup matches the namespace before fallback slicing runs, preventing accidental nested-type assumptions. | `BuildReport_NamespaceIndexBeatsNestedTypeHeuristics_WhenNamespaceContainsDots` |
| AltCover-only symbols with no namespace info | Fallback slicing builds `Namespace.Type`; `<global>` is used when there is no dot at all. | `BuildReport_MissingNamespaceFallsBackToStringSlicing` |
| Members appear before their declaring type | `EnsureTypeForMember` uses the same inference logic so members never spawn phantom namespaces. | Aggregation regression tests |

### Outcomes

- HTML displays nested types exactly once under their real namespace.
- `metrics-reader` filters that rely on namespace prefixes behave consistently regardless of which data source produced the node.
- Suppressions and baseline comparisons remain stable because fully qualified names do not drift when only AltCover contributes data.

