## How-to: Ship a Metrics Reporter Update via the Local Feed

Use this guide when you have code changes in `metricsreporter` and need to make them available to a consumer repository (for example, `sample-plugin`) through the local NuGet feed.

### Prerequisites

- Windows machine with PowerShell 7 (`pwsh`) and .NET 8 SDK.
- Local feed directory: `C:\Users\baidakov\.nuget\local-feed`.
- Two working copies:
  - `C:\Users\baidakov\metricsreporter`
  - `C:\Users\baidakov\sample-plugin`

### Step 1: Bump the version

1. Edit `Directory.Build.props` in the root of `metricsreporter`.
2. Increase at least the patch version for both `MetricsReporter` (library) and `MetricsReporter.Tool`. Reusing the same semantic version causes NuGet to serve cached packages.

### Step 2: Pack both projects to the feed

```powershell
cd C:\Users\baidakov\metricsreporter
dotnet pack MetricsReporter/MetricsReporter.csproj -c Release `
  -o C:\Users\baidakov\.nuget\local-feed
dotnet pack MetricsReporter.Tool/MetricsReporter.Tool.csproj -c Release `
  -o C:\Users\baidakov\.nuget\local-feed
```

Both `.nupkg` files now live beside earlier versions inside the feed directory. Keep older versions if you need rollback options.

### Step 3: Consume the new tool from the target repo

```powershell
cd C:\Users\baidakov\sample-plugin
dotnet tool update --tool-manifest .config\dotnet-tools.json `
  --add-source C:\Users\baidakov\.nuget\local-feed `
  MetricsReporter.Tool --version <new-version>
```

- The manifest pins the version for anyone else pulling the repo.
- Use `--no-cache` only when debugging feed issues; normally the version bump is enough.

If the consumer also references the library directly, update that package reference as well:

```powershell
dotnet add package MetricsReporter `
  --version <new-version> `
  --source C:\Users\baidakov\.nuget\local-feed
```

### Step 4: Verify end-to-end

1. Still inside the consumer repo, run `dotnet tool restore`.
2. Execute a metrics command, e.g.:

   ```powershell
   dotnet tool run metricsreporter metrics-reader readany --namespace Sample.Loader --metric Coupling
   ```

3. Optionally run `metricsreporter generate` (with your `.metricsreporter.json` and scripts) to prove the packaged bits still generate JSON/HTML correctly.

### Step 5: Commit and communicate

- Commit version bumps plus any release notes in `metricsreporter`.
- Commit the updated `.config/dotnet-tools.json` (and any `PackageReference` changes) in the consumer repo.
- Let the team know which semantic version is live in the feed so CI scripts can update their manifests.

