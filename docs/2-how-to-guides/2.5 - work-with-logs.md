## Work with logs

This guide shows how to enable and read MetricsReporter logs: where they are written, how verbosity works, and what to check when something fails.

### Where logs are written
- Console: always on, single-line format. Timestamps are omitted in `normal` verbosity for cleaner output; included in `quiet`, `minimal`, and `detailed` verbosity levels.
- File sink: enabled when you pass `--log-path` (CLI) or set `paths.logPath` in `.metricsreporter.json`. If omitted, the tool writes `MetricsReporter.log` beside the report/baseline. File logs always include UTC timestamps.
- Sharing: file sink allows parallel reads (`FileShare.ReadWrite|Delete`), but use unique log paths when running multiple instances.

### How to configure
- CLI:
  - `--log-path build/Metrics/Report/MetricsReporter.log`
  - `--verbosity quiet|minimal|normal|detailed` (default `normal`)
- Config (`.metricsreporter.json`, `paths` section):
  - `"logPath": "build/Metrics/Report/MetricsReporter.log"`
  - `"verbosity": "detailed"`
- Verbosity mapping:
  - `quiet|minimal` → Warning and above
  - `normal` → Information and above
  - `detailed` → Debug and above

### What gets logged
- Milestones (Information): start/finish, file load/write with durations, report/baseline actions.
- External processes: start, exit code, duration; stdout/stderr are truncated to 4000 chars on failure/timeout.
- Warnings: recoverable anomalies (missing optional inputs, timeouts, skipped steps).
- Errors: failures with exceptions and key context (paths, command, script).
- Scopes: logs often include solution, metrics directory, output paths, or script path.

### Quick run examples
- Generate with explicit log path and detailed verbosity:
  - `metricsreporter generate --metrics-dir build/Metrics --opencover build/Metrics/coverage.xml --roslyn build/Metrics/metrics.xml --output-json build/Metrics/Report/metrics-report.json --log-path build/Metrics/Report/MetricsReporter.log --verbosity detailed`
- HTML-only mode with custom log file:
  - `metricsreporter generate --input-json build/Metrics/Report/metrics-report.json --output-html build/Metrics/Report/metrics-report.html --log-path build/Metrics/Report/html-only.log`

### Troubleshooting checklist
- Set `--verbosity detailed` and rerun to capture Debug logs.
- Open the log file and search for:
  - `Failed to` / `timed out` / `exit code`
  - Start/finish pairs with durations (look for missing completion).
  - Truncated stdout/stderr lines when external processes fail.
- If logs are missing:
  - Ensure the directory in `--log-path` exists or is creatable.
  - Avoid sharing the same log file across concurrent runs; pick unique names per run.

### Good practices
- Keep logs near outputs (`Metrics/Report/`) for easy collection.
- For CI, store log artifacts alongside `metrics-report.json`.
- Do not log secrets; paths and exit codes are fine, but scrub tokens from arguments before passing them.

