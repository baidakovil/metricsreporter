## How-to: Run `generate` with config + scripts

Audience: CLI users and CI engineers who need to aggregate metrics with scripted prep steps.

Goal: Use `.metricsreporter.json` plus PowerShell hooks to produce JSON/HTML reports.

### Prerequisites
- `pwsh` available in PATH.
- Metrics artifacts accessible (AltCover XML, Roslyn metrics XML, SARIF files, baseline).
- A `.metricsreporter.json` committed near the repo root (discovery walks up from the working directory).

### 1) Define config with real paths
Create or update `.metricsreporter.json`:

```json
{
  "general": {
    "verbosity": "normal",
    "timeoutSeconds": 900,
    "logTruncationLimit": 4000
  },
  "paths": {
    "metricsDir": "Metrics",
    "report": "Metrics/MetricsReport.g.json",
    "outputHtml": "Metrics/MetricsReport.html",
    "baseline": "Metrics/MetricsTemp/MetricsBaseline.g.json",
    "thresholds": "Metrics/MetricsRules/MetricsReporterThresholds.json",
    "altcover": [ "Metrics/MetricsTemp/CoverageStorage.g.xml" ],
    "roslyn": [ "Metrics/Roslyn/SolutionMetrics.g.xml" ],
    "sarif": [ "Metrics/Sarif/ca.sarif" ],
    "baselineStoragePath": "%LOCALAPPDATA%/RCA/Metrics",
    "solutionName": "metricsreporter"
  },
  "scripts": {
    "generate": [
      "Metrics/scripts/prepare-metrics.ps1"
    ]
  }
}
```

### 2) Add prep script(s)
Place `Metrics/scripts/prepare-metrics.ps1` (example):

```powershell
# download coverage artifact or copy from CI staging
Write-Host "Preparing metrics inputs..."
```

Scripts run in order; the pipeline stops on the first non-zero exit code. The repoâ€™s default script delegates build/metrics collection to the `GenerateSolutionMetrics` MSBuild target, then the CLI aggregates inputs.

### 3) Run `generate`

```powershell
metricsreporter generate
```

Notes:
- CLI overrides config if provided (e.g., `--altcover tmp/cov.xml`).
- Working directory for scripts defaults to the current directory; override with `--working-dir`.
- Timeout per script defaults to 900s; override with `--timeout`.
- Logs: `MetricsReporter.log` is written under `Metrics/Report` (or next to `--output-json`).

### 4) Validate outputs
- `Metrics/MetricsReport.g.json` must exist.
- `Metrics/MetricsReport.html` is produced when `--output-html`/`paths.outputHtml` is set.
- Check exit code: `0` success, `1` parse error, `2` IO error, `3` validation error.

