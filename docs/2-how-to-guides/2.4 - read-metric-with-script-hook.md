## How-to: Run `read` with metric-scoped script hooks

Audience: CLI users and CI engineers who must execute preparatory scripts only for specific metrics before reading a report.

Goal: Configure `scripts.read.byMetric` (or CLI `--metric-script`) so a script runs when a matching metric is requested.

### Prerequisites
- Existing `MetricsReport.g.json` (e.g., `build/Metrics/Report/MetricsReport.g.json`).
- `pwsh` in PATH.

### 1) Configure metric-specific scripts
In `.metricsreporter.json`:

```json
"scripts": {
  "read": {
    "any": [ "scripts/refresh-report.ps1" ],
    "byMetric": [
      { "metrics": [ "OpenCoverBranchCoverage", "OpenCoverSequenceCoverage" ], "path": "scripts/coverage-read.ps1" },
      { "metrics": [ "RoslynClassCoupling" ], "path": "scripts/coupling-read.ps1" }
    ]
  }
}
```

- `any` scripts always run.
- `byMetric` entries run when any requested metric matches the `metrics` list (case-insensitive).
- Metric identifiers can also be requested via aliases configured in `metricAliases` (config/env/`--metric-aliases`), e.g., `"Coupling"` → `RoslynClassCoupling`.

### 2) (Optional) Override via CLI

```powershell
metricsreporter read `
  --report build/Metrics/Report/MetricsReport.g.json `
  --namespace Sample.Loader `
  --metric Coupling `
  --metric-script RoslynClassCoupling=scripts/coupling-read.ps1
```

CLI `--metric-script` entries are appended to configured scripts.

### 3) Execute `read`

```powershell
metricsreporter read `
  --report build/Metrics/Report/MetricsReport.g.json `
  --namespace Sample.Loader.Services `
  --metric Coupling `
  --all
```

Processing rules:
- Scripts run in order: `read.any` → matching `read.byMetric` → CLI `--script`/`--metric-script`.
- Each script uses `pwsh -File`, the resolved working directory (default: current directory), and the configured timeout (default 900s).
- Pipeline stops on first non-zero exit code; stdout/stderr are logged and truncated to the configured limit (default 4000 chars).

### 4) Check results
- Exit codes: `0` success, `1` parse error, `2` IO error, `3` validation error.
- Output lists violations; `--all` emits all matches, otherwise the most severe one. Grouping (`--group-by`) reshapes the JSON response.

